<%- include('../partials/header') %>

<div class="flex flex-col items-center w-full min-h-[70vh] px-5 py-10 sm:py-10 sm:pb-16">
  <h1 class="mt-1 text-3xl leading-10 text-center">
    Suggest a Movie Night&nbsp;Theme!
  </h1>

  <form
    x-data="{
      errors: {
        theme: '',
        movie1: '',
        movie2: '',
      },
      formData: {
        theme: '',
        movie1: '',
        movie2: '',
      },
      handleErrors: function(data) {
        if (data.errors) {
          this.errors = {
            theme: data.errors.theme,
            movie1: data.errors.movies,
            movie2: data.errors.movies,
          }
        }
        if (data.message) {
          alert(data.message)
        }
      },
      submit: async function() {
        const response = await fetch('/suggestions' , {
          method: 'POST',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            theme: this.formData.theme,
            movies: [
              this.formData.movie1,
              this.formData.movie2,
            ],
          }),
        });

        const data = await response.json();

        if (!response.ok) {
          this.handleErrors(data);

          return
        }

        window.location.href = '/?suggest_success';
      }
    }"
    class="w-full max-w-sm p-4 mt-5 space-y-5 rounded-lg bg-violet-200 sm:mt-8"
  >
    <%- include('../partials/input', {
      name: 'theme',
      placeholder: 'Something punny...',
    })  %>

    <%- include('../partials/input', {
      name: 'movie1',
      label: 'First Movie',
      placeholder: 'Triangle',
    })  %>

    <%- include('../partials/input', {
      name: 'movie2',
      label: 'Second Movie',
      placeholder: 'Triangle of Sadness',
    })  %>

    <button
      @click="submit()"
      :disabled="!formData.theme || !formData.movie1 || !formData.movie2 "
      type="button"
      class="inline-flex justify-center w-full px-3 py-2 text-sm font-semibold text-white rounded-md shadow-sm bg-violet-600 hover:bg-violet-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-600 sm:col-start-2"
      :class="!formData.theme || !formData.movie1 || !formData.movie2 ? 'opacity-50 cursor-not-allowed' : ''"
    >Submit Suggestion!</button>
  </form>
</div>

<%- include('../partials/footer') %>
